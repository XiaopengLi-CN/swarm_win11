#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
result_difference_analysis.py - åˆ†æç»“æœå·®å¼‚çš„åŸå› å’Œåˆç†æ€§
"""

import numpy as np
import pandas as pd
import ioh
from modcma import ModularCMAES

def analyze_result_differences():
    """
    åˆ†æç»“æœå·®å¼‚çš„åŸå› å’Œåˆç†æ€§
    """
    print("=" * 80)
    print("ğŸ” BIPOP-CMA-ESç»“æœå·®å¼‚åˆ†æ")
    print("=" * 80)
    
    print("\nğŸ“ æ‚¨çš„æƒ…å†µ:")
    print("âœ… ä½¿ç”¨ç›¸åŒæ¥æºçš„åº“ (modcma)")
    print("âœ… ç›¸åŒçš„BBOBé…ç½® (iid=1-10)")
    print("âœ… ç›¸åŒçš„è¿è¡Œæ¬¡æ•° (5æ¬¡)")
    print("âŒ ç»“æœä¸æ ‡å‡†ç­”æ¡ˆæœ‰å·®å¼‚")
    
    print("\nğŸ¯ é—®é¢˜: è¿™ç§å·®å¼‚æ˜¯å¦åˆç†?")

def test_randomness_sources():
    """
    æµ‹è¯•éšæœºæ€§çš„æ¥æº
    """
    print("\nğŸ§ª éšæœºæ€§æ¥æºæµ‹è¯•:")
    
    fid = 20
    dim = 10
    iid = 1
    budget = 2000
    
    print(f"æµ‹è¯•å‚æ•°: F{fid}, {dim}D, I{iid}, é¢„ç®—={budget}")
    
    # æµ‹è¯•1: å®Œå…¨ç›¸åŒçš„è®¾ç½®
    print("\næµ‹è¯•1: å®Œå…¨ç›¸åŒçš„è®¾ç½®")
    results1 = []
    for run in range(3):
        np.random.seed(42)  # å›ºå®šç§å­
        func = ioh.get_problem(fid, dimension=dim, instance=iid)
        c = ModularCMAES(func, d=dim, bound_correction='saturate', budget=budget, x0=np.zeros((dim, 1)))
        c.run()
        result = func.state.current_best.y
        results1.append(result)
        print(f"  è¿è¡Œ{run+1}: {result:.6f}")
        func.reset()
    
    # æ£€æŸ¥æ˜¯å¦å®Œå…¨ç›¸åŒ
    if len(set(results1)) == 1:
        print("âœ… ç›¸åŒç§å­äº§ç”Ÿç›¸åŒç»“æœ")
    else:
        print("âŒ ç›¸åŒç§å­äº§ç”Ÿä¸åŒç»“æœ")
        print(f"   å·®å¼‚èŒƒå›´: {max(results1) - min(results1):.10f}")
    
    # æµ‹è¯•2: ä¸åŒç§å­
    print("\næµ‹è¯•2: ä¸åŒç§å­")
    results2 = []
    for run in range(3):
        np.random.seed(100 + run)  # ä¸åŒç§å­
        func = ioh.get_problem(fid, dimension=dim, instance=iid)
        c = ModularCMAES(func, d=dim, bound_correction='saturate', budget=budget, x0=np.zeros((dim, 1)))
        c.run()
        result = func.state.current_best.y
        results2.append(result)
        print(f"  ç§å­{100+run}: {result:.6f}")
        func.reset()
    
    print(f"ä¸åŒç§å­å·®å¼‚èŒƒå›´: {max(results2) - min(results2):.6f}")

def analyze_difference_causes():
    """
    åˆ†æç»“æœå·®å¼‚çš„å¯èƒ½åŸå› 
    """
    print("\nğŸ” ç»“æœå·®å¼‚çš„å¯èƒ½åŸå› :")
    
    print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚ 1. éšæœºæ€§æ¥æº (ä¸»è¦)                                   â”‚")
    print("â”‚ â”œâ”€ ç®—æ³•å†…éƒ¨éšæœºæ•°ç”Ÿæˆ                                  â”‚")
    print("â”‚ â”œâ”€ åˆå§‹ç§ç¾¤ç”Ÿæˆ                                        â”‚")
    print("â”‚ â”œâ”€ å˜å¼‚å’Œé‡ç»„æ“ä½œ                                      â”‚")
    print("â”‚ â”œâ”€ é‡å¯æœºåˆ¶                                            â”‚")
    print("â”‚ â””â”€ è¾¹ç•Œå¤„ç†                                           â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ 2. ç¯å¢ƒå·®å¼‚ (æ¬¡è¦)                                    â”‚")
    print("â”‚ â”œâ”€ Pythonç‰ˆæœ¬å·®å¼‚                                     â”‚")
    print("â”‚ â”œâ”€ NumPyç‰ˆæœ¬å·®å¼‚                                      â”‚")
    print("â”‚ â”œâ”€ æ“ä½œç³»ç»Ÿå·®å¼‚                                       â”‚")
    print("â”‚ â”œâ”€ ç¡¬ä»¶å·®å¼‚                                           â”‚")
    print("â”‚ â””â”€ ç¼–è¯‘é€‰é¡¹å·®å¼‚                                       â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ 3. é…ç½®å·®å¼‚ (å¯èƒ½)                                    â”‚")
    print("â”‚ â”œâ”€ ç®—æ³•å‚æ•°è®¾ç½®                                       â”‚")
    print("â”‚ â”œâ”€ é¢„ç®—è®¾ç½®                                           â”‚")
    print("â”‚ â”œâ”€ ç»ˆæ­¢æ¡ä»¶                                           â”‚")
    print("â”‚ â”œâ”€ è¾¹ç•Œå¤„ç†æ–¹å¼                                       â”‚")
    print("â”‚ â””â”€ é‡å¯ç­–ç•¥                                           â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ 4. æ•°æ®è®°å½•å·®å¼‚ (å¯èƒ½)                                â”‚")
    print("â”‚ â”œâ”€ æ—¥å¿—è®°å½•æ–¹å¼                                       â”‚")
    print("â”‚ â”œâ”€ æ•°æ®ç²¾åº¦                                           â”‚")
    print("â”‚ â”œâ”€ ç»Ÿè®¡è®¡ç®—æ–¹æ³•                                       â”‚")
    print("â”‚ â””â”€ ç»“æœæå–æ–¹å¼                                       â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")

def test_algorithm_determinism():
    """
    æµ‹è¯•ç®—æ³•çš„ç¡®å®šæ€§
    """
    print("\nğŸ”¬ ç®—æ³•ç¡®å®šæ€§æµ‹è¯•:")
    
    fid = 20
    dim = 10
    iid = 1
    budget = 1000
    
    print("æµ‹è¯•: ç›¸åŒç§å­ + ç›¸åŒå‚æ•° = ç›¸åŒç»“æœ?")
    
    # å¤šæ¬¡æµ‹è¯•
    test_results = []
    for test in range(5):
        np.random.seed(42)
        func = ioh.get_problem(fid, dimension=dim, instance=iid)
        c = ModularCMAES(func, d=dim, bound_correction='saturate', budget=budget, x0=np.zeros((dim, 1)))
        c.run()
        result = func.state.current_best.y
        test_results.append(result)
        func.reset()
    
    # åˆ†æç»“æœ
    unique_results = len(set(test_results))
    print(f"å”¯ä¸€ç»“æœæ•°é‡: {unique_results}")
    
    if unique_results == 1:
        print("âœ… ç®—æ³•æ˜¯ç¡®å®šæ€§çš„ (ç›¸åŒè¾“å…¥äº§ç”Ÿç›¸åŒè¾“å‡º)")
    else:
        print("âŒ ç®—æ³•æœ‰éç¡®å®šæ€§å› ç´ ")
        print(f"ç»“æœèŒƒå›´: {max(test_results) - min(test_results):.10f}")

def explain_reasonableness():
    """
    è§£é‡Šå·®å¼‚çš„åˆç†æ€§
    """
    print("\nğŸ’¡ å·®å¼‚åˆç†æ€§åˆ†æ:")
    
    print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚ âœ… åˆç†çš„å·®å¼‚åŸå› :                                     â”‚")
    print("â”‚ â”œâ”€ ç®—æ³•æœ¬èº«å…·æœ‰éšæœºæ€§                                 â”‚")
    print("â”‚ â”œâ”€ ä¸åŒéšæœºç§å­äº§ç”Ÿä¸åŒç»“æœ                            â”‚")
    print("â”‚ â”œâ”€ ä¼˜åŒ–ç®—æ³•æœ¬è´¨ä¸Šæ˜¯éšæœºçš„                              â”‚")
    print("â”‚ â”œâ”€ ç›¸åŒé…ç½®ä¸‹ç»“æœæœ‰å˜åŒ–æ˜¯æ­£å¸¸çš„                        â”‚")
    print("â”‚ â””â”€ è¿™æ˜¯ä¼˜åŒ–ç®—æ³•çš„ç‰¹æ€§                                  â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ âŒ ä¸åˆç†çš„å·®å¼‚åŸå› :                                   â”‚")
    print("â”‚ â”œâ”€ ç®—æ³•å®ç°é”™è¯¯                                        â”‚")
    print("â”‚ â”œâ”€ å‚æ•°è®¾ç½®é”™è¯¯                                        â”‚")
    print("â”‚ â”œâ”€ æ•°æ®è®°å½•é”™è¯¯                                        â”‚")
    print("â”‚ â”œâ”€ ç¯å¢ƒé…ç½®é”™è¯¯                                        â”‚")
    print("â”‚ â””â”€ ç‰ˆæœ¬ä¸å…¼å®¹                                          â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")
    
    print("\nğŸ¯ åˆ¤æ–­æ ‡å‡†:")
    print("1. å·®å¼‚ç¨‹åº¦:")
    print("   - å°å·®å¼‚ (< 1%): æ­£å¸¸éšæœºæ€§")
    print("   - ä¸­ç­‰å·®å¼‚ (1-10%): å¯èƒ½çš„ç¯å¢ƒå·®å¼‚")
    print("   - å¤§å·®å¼‚ (> 10%): éœ€è¦æ£€æŸ¥é…ç½®")
    print("")
    print("2. ç»Ÿè®¡ç‰¹å¾:")
    print("   - ç»“æœåˆ†å¸ƒæ˜¯å¦åˆç†")
    print("   - å¹³å‡å€¼æ˜¯å¦æ¥è¿‘")
    print("   - æ ‡å‡†å·®æ˜¯å¦ç›¸ä¼¼")
    print("")
    print("3. è¶‹åŠ¿ä¸€è‡´æ€§:")
    print("   - ç›¸å¯¹æ’åæ˜¯å¦ä¸€è‡´")
    print("   - å‡½æ•°éš¾åº¦æ’åºæ˜¯å¦ä¸€è‡´")
    print("   - ç®—æ³•è¡¨ç°è¶‹åŠ¿æ˜¯å¦ä¸€è‡´")

def provide_solutions():
    """
    æä¾›è§£å†³æ–¹æ¡ˆ
    """
    print("\nğŸ”§ è§£å†³æ–¹æ¡ˆ:")
    
    print("â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”")
    print("â”‚ 1. éªŒè¯ç®—æ³•ç¡®å®šæ€§                                     â”‚")
    print("â”‚ â”œâ”€ ä½¿ç”¨ç›¸åŒç§å­æµ‹è¯•                                    â”‚")
    print("â”‚ â”œâ”€ æ£€æŸ¥æ˜¯å¦äº§ç”Ÿç›¸åŒç»“æœ                                â”‚")
    print("â”‚ â”œâ”€ ç¡®è®¤ç®—æ³•å®ç°æ­£ç¡®                                    â”‚")
    print("â”‚ â””â”€ éªŒè¯å‚æ•°è®¾ç½®ä¸€è‡´                                    â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ 2. å¢åŠ è¿è¡Œæ¬¡æ•°                                        â”‚")
    print("â”‚ â”œâ”€ ä»5æ¬¡å¢åŠ åˆ°10æ¬¡æˆ–æ›´å¤š                               â”‚")
    print("â”‚ â”œâ”€ è®¡ç®—ç»Ÿè®¡é‡ (å¹³å‡å€¼ã€æ ‡å‡†å·®)                         â”‚")
    print("â”‚ â”œâ”€ æä¾›ç½®ä¿¡åŒºé—´                                        â”‚")
    print("â”‚ â””â”€ å‡å°‘éšæœºæ€§å½±å“                                      â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ 3. è¯¦ç»†è®°å½•é…ç½®                                        â”‚")
    print("â”‚ â”œâ”€ è®°å½•æ‰€æœ‰å‚æ•°è®¾ç½®                                    â”‚")
    print("â”‚ â”œâ”€ è®°å½•ç¯å¢ƒä¿¡æ¯                                        â”‚")
    print("â”‚ â”œâ”€ è®°å½•ç‰ˆæœ¬ä¿¡æ¯                                        â”‚")
    print("â”‚ â””â”€ ä¾¿äºé—®é¢˜å®šä½                                        â”‚")
    print("â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤")
    print("â”‚ 4. ä¸åŸä½œè€…è”ç³»                                        â”‚")
    print("â”‚ â”œâ”€ ç¡®è®¤å®éªŒé…ç½®                                        â”‚")
    print("â”‚ â”œâ”€ è·å–è¯¦ç»†å‚æ•°                                        â”‚")
    print("â”‚ â”œâ”€ äº†è§£ç¯å¢ƒè¦æ±‚                                        â”‚")
    print("â”‚ â””â”€ è·å¾—æŠ€æœ¯æ”¯æŒ                                        â”‚")
    print("â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜")

def answer_key_questions():
    """
    å›ç­”å…³é”®é—®é¢˜
    """
    print("\nâ“ å…³é”®é—®é¢˜å›ç­”:")
    
    print("Q1: è¿™ç§å·®å¼‚æ˜¯å¦åˆç†?")
    print("A1: âœ… æ˜¯çš„ï¼Œè¿™æ˜¯åˆç†çš„ã€‚ä¼˜åŒ–ç®—æ³•æœ¬èº«å…·æœ‰éšæœºæ€§ï¼Œ")
    print("    ç›¸åŒé…ç½®ä¸‹äº§ç”Ÿä¸åŒç»“æœæ˜¯æ­£å¸¸çš„ã€‚")
    
    print("\nQ2: ç®—æ³•è¿è¡Œæ˜¯å¦å¸¦æœ‰éšæœºæ€§?")
    print("A2: âœ… æ˜¯çš„ï¼ŒBIPOP-CMA-ESæ˜¯éšæœºä¼˜åŒ–ç®—æ³•ï¼Œ")
    print("    æ¯æ¬¡è¿è¡Œéƒ½ä¼šäº§ç”Ÿä¸åŒçš„ç»“æœã€‚")
    
    print("\nQ3: æ˜¯å¦å¯èƒ½å¾—åˆ°ä¸åŸå®éªŒä¸€æ ·çš„ç»“æœ?")
    print("A3: âœ… æ˜¯çš„ï¼Œä½†éœ€è¦:")
    print("    - ä½¿ç”¨å®Œå…¨ç›¸åŒçš„éšæœºç§å­")
    print("    - ä½¿ç”¨å®Œå…¨ç›¸åŒçš„å‚æ•°è®¾ç½®")
    print("    - ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ç¯å¢ƒé…ç½®")
    print("    - ä½¿ç”¨å®Œå…¨ç›¸åŒçš„ç®—æ³•ç‰ˆæœ¬")
    
    print("\nQ4: å¦‚ä½•å‡å°‘å·®å¼‚?")
    print("A4: å»ºè®®:")
    print("    - å¢åŠ è¿è¡Œæ¬¡æ•° (å¦‚10-20æ¬¡)")
    print("    - è®¡ç®—ç»Ÿè®¡é‡è€Œéå•æ¬¡ç»“æœ")
    print("    - è®°å½•è¯¦ç»†çš„é…ç½®ä¿¡æ¯")
    print("    - ä¸åŸä½œè€…ç¡®è®¤å®éªŒè®¾ç½®")

if __name__ == "__main__":
    analyze_result_differences()
    test_randomness_sources()
    analyze_difference_causes()
    test_algorithm_determinism()
    explain_reasonableness()
    provide_solutions()
    answer_key_questions()
    
    print("\n" + "=" * 80)
    print("æ€»ç»“: ç»“æœå·®å¼‚æ˜¯åˆç†çš„ï¼Œä¼˜åŒ–ç®—æ³•æœ¬èº«å…·æœ‰éšæœºæ€§")
    print("=" * 80)
